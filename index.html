
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DQ3 Item Compatibility</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .table-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            overflow-x: auto; /* Enable horizontal scrolling for wide tables */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            white-space: nowrap; /* Prevent text wrapping in cells */
        }
        th {
            background-color: #e2e6e9;
            color: #555;
            position: sticky; /* Make headers sticky for horizontal scroll */
            left: 0;
            z-index: 1; /* Ensure header stays above content */
        }
        td.class-name {
            background-color: #f9f9f9;
            font-weight: bold;
            position: sticky; /* Make class names sticky for horizontal scroll */
            left: 0;
            z-index: 1; /* Ensure class name stays above content */
        }
        th:first-child, td:first-child {
            position: sticky;
            left: 0;
            z-index: 2; /* Ensure corner cell and class names stay on top */
            background-color: #e2e6e9; /* Match header background */
        }
        .item-available {
            background-color: #e6ffe6; /* Light green for available items */
        }
        .item-not-available {
            background-color: #ffe6e6; /* Light red for unavailable items */
            color: #aaa;
        }
        .item-cursed {
            background-color: #ffaaaa; /* Bright red for cursed items */
            color: #aaa;
        }
        .item-type-heading {
            font-size: 1.5em;
            color: #34495e;
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Dragon Quest III Item Compatibility</h1>
    <div id="app"></div>

    <script>
        const version = 1;
        async function safeFetchJson(url) {
          const finalUrl = url + (url.includes('?') ? '&v=' : '?v=') + version;
          const res = await fetch(finalUrl);
          if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${url}`);
          }
          return res.json();
        }
        document.addEventListener('DOMContentLoaded', async () => {
            const appDiv = document.getElementById('app');
            const jsonData = await safeFetchJson('dat/dw4.json');
            const classes = jsonData.classes;

            // Define the order of item types for display
            const itemTypesOrder = ['armor', 'shields', 'helmets', 'weapons'];

            itemTypesOrder.forEach(itemType => {
                const itemsOfType = jsonData[itemType];
                if (!itemsOfType || itemsOfType.length === 0) {
                    return; // Skip if no items for this type
                }

                const itemTypeName = itemType.charAt(0).toUpperCase() + itemType.slice(1); // Capitalize first letter

                const tableContainer = document.createElement('div');
                tableContainer.classList.add('table-container');

                const heading = document.createElement('h2');
                heading.classList.add('item-type-heading');
                heading.textContent = `${itemTypeName} Compatibility`;
                tableContainer.appendChild(heading);

                const table = document.createElement('table');
                const thead = document.createElement('thead');
                const tbody = document.createElement('tbody');

                // Create table header row
                const headerRow = document.createElement('tr');
                const emptyTh = document.createElement('th');
                emptyTh.textContent = 'Class \\ Item'; // Corner cell
                headerRow.appendChild(emptyTh);

                itemsOfType.forEach(item => {
                    const th = document.createElement('th');
                    th.textContent = item.name;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                // Create table body rows
                classes.forEach(cls => {
                    const row = document.createElement('tr');
                    const classNameTd = document.createElement('td');
                    classNameTd.classList.add('class-name');
                    classNameTd.textContent = cls.name;
                    classNameTd.style.backgroundColor = cls.color; // Set class color
                    row.appendChild(classNameTd);

                    itemsOfType.forEach(item => {
                        const cell = document.createElement('td');
                        // Check if the current class (cls) has the current item (item.name) in its allowed list for this item type
                        const isCompatible = cls[itemType] && cls[itemType].includes(item.name);
                        const isCursed = item.cursed !== null;
                        
                        if (isCompatible) {
                            cell.textContent = item.name;
                            if (isCursed) {
                              cell.classList.add('item-cursed');
                            } else {
                              cell.classList.add('item-available');
                            }
                        } else {
                            // cell.textContent = 'â€”'; // Or leave empty
                            cell.classList.add('item-not-available');
                        }
                        row.appendChild(cell);
                    });
                    tbody.appendChild(row);
                });
                table.appendChild(tbody);
                tableContainer.appendChild(table);
                appDiv.appendChild(tableContainer);
            });
        });
    </script>
</body>
</html>
